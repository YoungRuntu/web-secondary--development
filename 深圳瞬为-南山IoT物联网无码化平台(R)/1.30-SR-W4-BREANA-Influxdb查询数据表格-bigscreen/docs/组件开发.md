---
title: 组件开发
nav:
  title: 大屏
  path: /bigcreen
group:
  title: 组件开发
  path: /dev
toc: menu
---


## 操作步骤

步骤1、打开下载的插件包，编辑“../pluginTemp/config.json”配置文件，如下所示。

~~~
{
  "id": "3519b44f-8f66-57ca-bdbf-75d655206b47",
  "type": "bigscreen",
  "main": "main.d4337c05.js",
  "version": "2"
}
~~~

| 参数 | 参数说明 |
| --- | --- |
| id | 插件标识，用户在下载插件模板时，系统自动生成，用户无需自定义。 |
| type | 插件类型，插件类型为“bigscreen”  标识其为数据大屏的插件。 |
| version | 表示插件的版本。 |

步骤2、数睿平台加载二开插件，调用二开的渲染函数会导入一些平台数据，以支持组件的渲染依赖。

| 名称 | 数据结构 |
| --- | --- |
| bigScreen\_data | 二开插件渲染需要依赖的数据。 |
| bigScreen\_options | 大屏二开的配置类信息。 |
| variable | 大屏定义的变量信息。 |

* bigScreen\_data 数据结构，示例如下。

```
[
 ["描述", "数字"],
 ["铅笔数", 1],
 ["笔记本数", 8],
 ["钢笔数", 3]
]
```

* bigScreen\_options 数据结构，示例如下。

```
// bigScreen_options
{
  showColumns: ["指标名称", "数值"],  //  用户选择需要展示的列
  columns: ["年份", "数值", "指标名称"],   // 资产里所有的列，由选中的数据源决定
  dataSourceType: 2, // 1 代表表格数据；2 代表分析仪数据；3代表填报；4代表数据资产， 由选中的数据源决定
};
```

* variable 数据结构，示例如下。

```
{
  default_value: "变量",
  id: "变量ID",
};
```

步骤3、数睿平台加载插件，会通过预设的固定传参，以达到平台数据的共享到插件包。

```
~~~
// src/App.js
import React, { Component } from "react";
import * as echarts from "echarts";
import "./app.css";
export default class App extends Component {
  divRef = null;
  state = {
    dataSource: [],
    rowId: "",
    default_value: "",
    id: "",
  };
  fnref = (el) => {
    this.divRef = el;
  };
    // echart 渲染函数
  initChart = (variable, bigScreen_options, bigScreen_data) => {
    // 初始化echarts
    const myChart = echarts.init(this.divRef);
    // 处理数据
    const data = bigScreen_data.map((v) => {
      return {
        value: v[1],
        name: v[0],
      };
    });
    const { default_value = "测试的数据", id = "测试的名称" } = variable;
    this.setState({
      default_value,
      id,
    });

    // echarts 配置
    let option = {
      title: {
        text: "演示数据",
        subtext: "演示二级标题",
        left: "center",
        textStyle: {
          color: "#f0f",
          fontWeight: "bold",
        },
      },
      // ...
    };
    if (option && typeof option === "object") {
      myChart.setOption(option);
      myChart.resize();
    }
  };
  componentDidMount() {
    if (this.divRef) {
      // 从 props 上获取数据
      const bigScreen_options = this.props.options || {};
      const variable = this.props.variable;
      const bigScreen_data = this.props.data || [];
      // 渲染饼图
      this.initChart(variable, bigScreen_options, bigScreen_data);
    }
  }
  render() {
    const { default_value, id } = this.state;
    const { data, options, variable, componentId } = this.props;
    return data && options && (
      <>
          <div ref={this.fnref} style={{ width: "100%", height: "100%" }}></div>
      </>
    );
  }
}
~~~
```
